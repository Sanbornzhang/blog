---
title: 幂等性
date: 2018/10/11
categories: 
- 架构
- 幂等
- 秒杀
- 分布式
tags: 
- 架构
- 幂等
- 秒杀
- 分布式
---
# 幂等幂等性
## 什么是幂等
    在编程中一个幂等操作的特点是其任意多次执行所产生的影响均与一次执行的影响相同。幂等函数，或幂等方法，是指可以使用相同参数重复执行，并能获得相同结果的函数。这些函数不会影响系统状态，也不用担心重复执行会对系统造成改变

    一个HTTP方法是幂等的，指的是同样的请求被执行一次与连续执行多次的效果是一样的，服务器的状态也是一样的。换句话说就是，幂等方法不应该具有副作用（统计用途除外）。在正确实现的条件下，GET，HEAD，PUT和DELETE 等方法都是幂等的，而 POST 方法不是。所有的 safe 方法也都是幂等的。
<!--more-->

## 为什么需要幂等
1. 我们发起一笔付款请求，应该只扣用户账户一次钱。
2. 创建业务订单，一次业务请求只能创建一个。  
...

## 实现幂等的几种方式
1. 每次操作都新增到对应表中，取数据通过计算来达到。 只存储事务记录不存储状态[函数式编程，事件溯源]
2. 记录上次修改的时间/状态 再更新的时候加上`where`条件，对于新增的操作使用findOrCreate。
3. 使用数据库自带的原子操作[MongoDB]
4. 使用分布式锁。
5. 使用消息队列