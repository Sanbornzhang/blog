---
title: 重构（速读 《重构 改善既有代码的设计》）
date: 2019/7/22
updated: 2019/10/4
sticky: 10
top: 10
categories: 
- 重构
- 重构 改善既有代码的设计
tags: 
- 重构
- 重构 改善既有代码的设计
---
# 重构
    在不改变代码的外在行为的前提下，对代码进行修改，以改进程序的内部结构。
> 重构就是在代码写好之后改进他的设计，改善代码的设计质量。
## 重构的目的
1. 使代码容易阅读
2. 所有的逻辑都只在唯一地点指定
3. 新的改动不会危及到现有行为
4. 尽可能简单表达逻辑条件
## 什么时候进行重构
   事不过三，三则重构
> 第一次去做某件事事情的时候只管去做，第二次做类似事情时会产生反感，单无论如何还是可以去做。第三次再做的时候，你就应该重构
<!--more-->
## 为何重构
### 重构改进软件设计
- 重复可以改善代码的设计：  
  1. 如果没有重构，程序的设计往往会逐渐腐败变质。通常我们也可能会以短期为目的、或者是再完全理解整体设计之前，就贸然修改代码，序将逐渐失去自己的结构。越来越难通过阅读代码来理解原来的设计。
  2. 代码结构的流失是基类性的，越难看都过的设计意图，就越难保护其中的设计，于是代码就腐败的越快。经常性的重构代码有助于帮助代码维持自己该有的形态。
- 消除重复的代码：
  1.  完成同样一件事，设计不良的程序往往需要修改更多的代码。这常常是因为代码在不同的地方使用完全相同的语句做同样的事情。因此改善设计的一个重要的方向就是消除重复的代码。
  2.  代码量减少并不会使系统运行的更快，但是在将来我们修改的时候，会**大大节约**修改时间。
  3.  代码量越多就越不利于修改，因为有更多的代码需要理解。你可能需要修改很多次才能达到预期的效果，而且也不利于测试的进行。
  4.  如果消除重复代码，你就可以确定所有的事物和行为在代码中之表述一次，这正是优秀设计的根本
- 让代码变得更易于理解
  > 对代码进行适当的修改，使他变得容易理。重构可以帮助我们让代码更易读。因为你的代码不仅仅是写给将计算机看的，你的代码还有其他的读者。如果几个月以后有另一位程序员尝试读懂你的代码并作出一些修改。我们很容易忘记第二位读者，但是他才是最重要的。如果其他程序员需要花费1周来读懂你所写的代码，那是不是十分糟糕呢？如果他了解了你所写的代码，这个时间可能只需要1个小时或者更少。
- 重构帮我们理解不熟悉的代码
  重构能够协助我们理解不熟悉的代码。当我们看见不熟悉的代码时，我们必须先看几行然后慢慢理解。但是有了重构我们可以修改代码，更好的反映出我们的理解，然后重新执行。这样可以帮助我们理解代码的逻辑【一般逻辑不清楚的代码、看着很吃力的代码，很可能就需要重构了， 因为代码更多的是写给人看的】，随着我们对代码做出的修改我们可能会看到一些以前看不到的设计层面上的一些东西。

### 重构帮助我们**找到BUG**
  对于代码的理解，可以帮助我们找到BUG。BUG的存在很大部分是因为逻辑不清楚造成的。而重构能够帮助我们理清代码逻辑。

### 重构提高编程速度
  重构可以改善代码的的设计，当有良好的设计之后，我们的开发就变得快速起来了。如果没有良好的设计，或许在某一段时间中我们的进展迅速，但是糟糕的设计很快就让我们开发速度降下来了，并且会花费更多的时间去调试、去理解代码的逻辑、修改重复性的代码、没有使用的代码。随着打上了越来越多的补丁，新的功能需要更多的代码实现、或者是更多的重复代码。最终造成恶性循环。
> 良好的设计才是维持原件开发速度的根本，重构可以改善既有代码的设计质量，阻止系统腐败变质、使代码变得更容易理解。 所以能够帮我们更快的开发软件
## 间接层和重构
#### 间接层的价值
1. 允许逻辑共享
2. 分开解释意图和实现
3. 隔离变换
4. 封装条件逻辑
## 重构的方法
1. 提取函数( 单一原则，封装)
2. 修改命名方式(好的代码应该所见即所得！)
3. 查看函数位置是否正确，如果在一个类中的`Function`，并没有使用这个类，而是使用了其他类，那么是不是应该放在其他的类中？

## 可以重构的一些代码
- 重复的代码
  
- 过长的函数
- 过大的类
- 过长的参数列
- 发散模式变化（开闭原则？）： 让软件更易于修改
- 霰弹式修改： 每当遇到某种状态时，需要在许多不同的地方修改
- 依恋情结： 函数放的位置有问题，函数对某个类的需求高于函数所放的类中
- 数据泥团： 不同的类中含有多个相同的字段相同的参数
- 基本类型偏执： 有的时候我们该使用基本类型的时候就应该使用，不要因为事情很小就避免去使用。
- switch惊悚现身: 少使用switch语句，
- 平行继承体系
- 亢赘类
- 夸夸其谈的未来性
- 令人迷惑的暂时字段
- 过度耦合的消息链
- 过多的中间人
- 狎昵关系： 类 过度的耦合
- 异曲同工的类
- 不完美的库类
- 纯稚的数据类
- 错误的继承关系： 子类复用了超类的实现，却不愿意支持超类的接口
- 过多的注释

## 重构的列表
### 记录
    简单扼要的介绍这个重构能够帮助解决的问题，简单的介绍你要做的事情；简单的介绍重构前后的示例
1. 名称： 创建一个重构词汇表
2. 概要： 简单的介绍当前重构手法的使用场景，以及它能做的事情
3. 动机： 介绍“为什么需要重构” 以及 “什么情况下不该使用这个重构”
4. 做法： 简明扼要的一步一步介绍如何进行这个重构
5. 范例： 以一个十分简单的例子说明这个重构的手法怎么运作

### 寻找引用点
### 这些重构手法有多成熟
小步前进，频繁测试

## 重新组织函数
### Extract Method（提炼函数）
     把一小段代码组织在一起并且独立起来(个人觉得不要为了提炼而去提炼)
#### 动机
    过长的函数或者需要一段注释才能让人看懂得代码
好处：如果每个函数的粒度都很小，那么函数被复用的机会就更大；良好的函数命名会使高层函数读起来就像是一系列的注释；如果函数都是细粒度，那么函数的复写也会更容易。
#### 做法
1. 创建一个新函数，根据这个函数的意图来对他进行命名
2. 